import { useSetAtom } from 'jotai'
import Head from 'next/head'

import { useNavTab } from '@/common/hook/useNavTab'
import { useRouterEvent } from '@/common/hook/useRouterEvent'
import type { CurrentUser, SingleQuestion } from '@/common/type'
import { resetEditedQuestionAtom, resetQuestionDescriptionAtom } from '@/store/atom'

import { QuestionDetail } from './QuestionDetail'

/**
 * @package
 */

export const QuestionDetailPage = (props: { question: SingleQuestion; currentUser: CurrentUser }) => {
  const { question, currentUser } = props

  const resetEditedQuestion = useSetAtom(resetEditedQuestionAtom)
  const resetDescription = useSetAtom(resetQuestionDescriptionAtom)

  useNavTab('null', 'null')
  useRouterEvent({ eventName: 'routeChangeComplete', callback: resetEditedQuestion })
  useRouterEvent({ eventName: 'routeChangeComplete', callback: resetDescription })

  return (
    <>
      <Head>
        <title>Recurrot - {question.title} </title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>

      <QuestionDetail id={question.id} question={question} currentUser={currentUser} />
    </>
  )
}
